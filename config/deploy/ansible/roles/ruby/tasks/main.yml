---
- name: Install ruby dependencies
  apt: pkg=$item state=installed update-cache=yes
  with_items:
    - build-essential
    - libreadline6-dev
    - libyaml-dev
    - libsqlite3-dev
    - sqlite3
    - libgdbm-dev
    - libncurses5-dev
    - libtool
    - bison
    - libffi-dev
    - libdigest-hmac-perl
    - unzip
    - zlib1g
    - zlib1g-dev

- name: Download ruby
  get_url: url={{ruby_url}} dest=/tmp/ruby-{{ ruby_version }}.tar.gz

- name: Extract ruby
  command: tar -xvf /tmp/ruby-{{ ruby_version }}.tar.gz chdir=/tmp

- name: Make, configure, and install ruby
  command: chdir=/tmp/ruby-{{ ruby_version }} {{item}}
  with_items:
    - ./configure
    - make
    - sudo make install
